<%# View that the Picker sees during the game%>
<%=game.rounds%>
<h1 id="picker">You are the picker</h1>

<%# David's code to get photos%>

<div id="pickerPhotos">
  <h2>Waiting for Pictures...</h2>
</div>








<%# Phil's code for word generator%>
<div class="row">

  <div class="col-lg-offset-3 col-lg-6">
    <div class="input-group">

      <span class="input-group-btn">
        <button class="generate" type="button">reload</button>
      </span>
      <input id="word" type="text" class="form-control" placeholder="Word generated">

      <span class="input-group-btn">
        <button class="btn btn-secondary" type="button">submit</button>
      </span>

    </div>
  </div>
</div>


<%# ajax pull for word generator api%>
<script type="text/javascript">

/////////////David's photo logic///////
console.log('Players: <%=game.users.length-1%>')
console.log('pics uploaded: <%=game.rounds[game.rounds.length-1].pics.length%>')
var players = <%=game.users.length-1%>
var pics = <%=game.rounds[game.rounds.length-1].pics.length%>

if(players == pics){
  console.log("players equals pics")
  $('#pickerPhotos').html("")
  $.ajax({
    method: 'GET',
    url: '/game/<%= game._id %>/photos',
  }).done(function(data){
    data.forEach(function(el){
      console.log(el.url)
      $('#pickerPhotos').append('<img class="photosToPick" user="'+el.user+'" src="'+ el.url+ '">')
    })
  })
}


$('#pickerPhotos').on('click', '.photosToPick', function(){
  var winner = $(this).attr('user')
  var pic = $(this).attr('src')
  var results = {user: winner, url: pic}
  var lastRoundNumber = <%=game.rounds[game.rounds.length-1].round%>
  var data = {round: lastRoundNumber+1, picker: winner, pics: []}
  $.ajax({
    method: 'PATCH',
    url: '/game/<%=game._id%>/winner',
    contentType: 'application/json',
    data: JSON.stringify(results)
  }).done(function(results){
    console.log(results)
  })
  $.ajax({
    method: 'PATCH',
    url: '/game/<%=game._id%>/new_round',
    contentType: 'application/json',
    data: JSON.stringify(data)
  }).done(function(data){
    console.log("Winner is: "+data)
    window.location.href = '/game/<%=game._id%>'
  })

})






//////////////////////////////////////

//   console.log("game page working")
//   var $picker = $('#picker')
//   var picker;
//
// Game.c
//
//   if(Use)
//
//   $picker.append()
//
//
//   $('.generate').on('click', function(){
//         $.ajax({
//           method: 'GET',
//           url: '/words/random'
//         }).done(function(data){
//           $('#word').append(data);
//         })
//       }

</script>
